<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Artworks</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    .headerbar{
      display:flex; justify-content:space-between; align-items:center; gap:14px;
      flex-wrap:wrap;
    }
    .header-actions{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .btn-small{
      padding:10px 12px;
      border:1px solid #eee;
      background:#fff;
      cursor:pointer;
      font-family:inherit;
      font-size:14px;
    }

    .controls{
      margin-top:14px;
      display:grid;
      gap:12px;
    }
    .filters{
      display:grid;
      grid-template-columns: 1.6fr 1fr 1fr 1fr;
      gap:10px;
    }
    .filters input, .filters select{
      width:100%;
      padding:10px 12px;
      border:1px solid #ddd;
      font-family:inherit;
      font-size:14px;
      background:#fff;
    }
    .chips{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      color:#666; font-size:13px;
    }


    .muted{ color:#777; font-size:13px; }

    .items{
      display:grid;
      gap:12px;
      margin-top:14px;
    }
    .rowlink{ text-decoration:none; color:inherit; }
    .item{
      display:grid;
      grid-template-columns: 86px 1fr auto;
      gap:14px;
      align-items:center;
      padding:12px;
      border:1px solid #eee;
      background:#fff;
    }
    .item:hover{ border-color:#ddd; }
    .thumb{
      width:86px; height:86px;
      border-radius:12px;
      background:#eaeaea;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color:#777;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .title{ font-weight:700; }
    .meta{ margin-top:3px; font-size:13px; color:#666; }
    .right{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .tag{
      font-size:12px;
      padding:6px 10px;
      background:#f1f1f1;
      color:#222;
      white-space:nowrap;
    }

    /* Print styles */
    @media print {
      .header-actions,
      .controls,
      .back,
      .btn,
      .btn-small { display:none !important; }
      .card { box-shadow:none !important; border:none !important; }
      .item { break-inside: avoid; }
      .rowlink { text-decoration:none !important; }
      .tag { display:none !important; }
    }

    @media (max-width: 980px){
      .filters{ grid-template-columns: 1fr 1fr; }
      .item{ grid-template-columns: 76px 1fr; }
      .right{ justify-content:flex-start; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">

      <div class="headerbar">
        <h2 style="margin:0;">List Of Artworks</h2>
        <div class="header-actions">
          <a class="btn" href="{{ url_for('add_artwork') }}">Add artwork</a>
          <button class="btn" id="printBtn" type="button">Print page</button>
        </div>
      </div>

      {% set mediums = artworks | map(attribute='medium') | select | list %}
      {% set years = artworks | map(attribute='year') | select | list %}
      {% set projects = artworks | map(attribute='series') | select | list %}

      <div class="controls">
        <div class="filters">
          <input id="q" type="search" placeholder="Search title, medium, project, year, ID…">

          <select id="fMedium">
            <option value="">All materials</option>
            {% for m in mediums|unique|sort %}
              <option value="{{ m|e }}">{{ m }}</option>
            {% endfor %}
          </select>

          <select id="fYear">
            <option value="">All dates</option>
            {% for y in years|unique|sort %}
              <option value="{{ y|e }}">{{ y }}</option>
            {% endfor %}
          </select>

          <select id="fProject">
            <option value="">All projects</option>
            {% for p in projects|unique|sort %}
              <option value="{{ p|e }}">{{ p }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="chips">
          <span class="chip">Total: <strong id="total">{{ artworks|length }}</strong></span>
          <span class="chip">Shown: <strong id="shown">{{ artworks|length }}</strong></span>
          <button class="btn-small" id="resetBtn" type="button">Reset</button>
          <span class="muted" id="activeText"></span>
        </div>
      </div>

      {% if artworks and artworks|length > 0 %}
        <div class="items" id="items">
          {% for artwork in artworks %}
            <a class="rowlink"
               href="{{ url_for('artwork_detail', artwork_id=artwork.id) }}"
               data-medium="{{ (artwork.medium or '')|lower|e }}"
               data-year="{{ (artwork.year or '')|lower|e }}"
               data-project="{{ (artwork.series or '')|lower|e }}"
               data-search="{{ (
                 (artwork.title or '') ~ ' ' ~
                 (artwork.medium or '') ~ ' ' ~
                 (artwork.series or '') ~ ' ' ~
                 (artwork.year or '') ~ ' ' ~
                 (artwork.id|string)
               )|lower|e }}"
            >
              <div class="item">
                <div class="thumb">
                  {% if artwork.image_filename %}
                    <img src="{{ url_for('uploaded_file', filename=artwork.image_filename) }}" alt="">
                  {% else %}
                    no image
                  {% endif %}
                </div>

                <div>
                  <div class="title">{{ artwork.title }}</div>
                  <div class="meta">
                    {{ artwork.year or "—" }} · {{ artwork.medium or "—" }}
                    {% if artwork.series %} · {{ artwork.series }}{% endif %}
                    · ID {{ artwork.id }}
                  </div>
                </div>

                <div class="right">
                  {% if artwork.for_sale %}
                    <span class="tag">For sale</span>
                  {% endif %}
                  <span class="tag">Open</span>
                </div>
              </div>
            </a>
          {% endfor %}
        </div>

        <p id="emptyState" class="muted" style="display:none; margin-top:14px;">
          No artworks match your filters.
        </p>
      {% else %}
        <p class="muted" style="margin-top:14px;">No artworks yet.</p>
      {% endif %}

      <a class="back" href="{{ url_for('home') }}">← Home</a>
    </div>
  </div>

  <script>
    (function(){
      const q = document.getElementById('q');
      const fMedium = document.getElementById('fMedium');
      const fYear = document.getElementById('fYear');
      const fProject = document.getElementById('fProject');

      const items = document.getElementById('items');
      const emptyState = document.getElementById('emptyState');

      const shown = document.getElementById('shown');
      const activeText = document.getElementById('activeText');
      const resetBtn = document.getElementById('resetBtn');
      const printBtn = document.getElementById('printBtn');

      const norm = (v) => (v || '').toString().trim().toLowerCase();

      function apply(){
        if (!items) return;

        const qs = norm(q.value);
        const m = norm(fMedium.value);
        const y = norm(fYear.value);
        const p = norm(fProject.value);

        const active = [];
        if (qs) active.push(`Search: “${q.value.trim()}”`);
        if (m) active.push(`Material: ${fMedium.value}`);
        if (y) active.push(`Date: ${fYear.value}`);
        if (p) active.push(`Project: ${fProject.value}`);
        activeText.textContent = active.length ? active.join(' · ') : '';

        let count = 0;
        const rows = items.querySelectorAll('a.rowlink');

        rows.forEach(row => {
          const ds = row.dataset;
          const okSearch = !qs || (ds.search || '').includes(qs);
          const okM = !m || (ds.medium || '') === m;
          const okY = !y || (ds.year || '') === y;
          const okP = !p || (ds.project || '') === p;

          const ok = okSearch && okM && okY && okP;
          row.style.display = ok ? '' : 'none';
          if (ok) count += 1;
        });

        shown.textContent = String(count);
        if (emptyState) emptyState.style.display = count === 0 ? '' : 'none';
      }

      function reset(){
        q.value = '';
        fMedium.value = '';
        fYear.value = '';
        fProject.value = '';
        apply();
      }

      [q, fMedium, fYear, fProject].forEach(el => {
        if (!el) return;
        el.addEventListener('input', apply);
        el.addEventListener('change', apply);
      });

      if (resetBtn) resetBtn.addEventListener('click', reset);
      if (printBtn) printBtn.addEventListener('click', function(){ window.print(); });

      apply();
    })();
  </script>
</body>
</html>
